# 产品需求文档（PRD）

## 1. 项目背景\n\n## 1.5 非功能性需求（NFR）\n- 性能：生成/导出单张日签≤1.5s（中端Android），首屏≤2.5s（Web 4G）。\n- 包体：APK≤30MB（阶段一），Web资源主包≤500KB（gzip）。\n- 兼容：Android 8.0+；桌面/移动Chrome、Safari、Edge最新版；中文/英文。\n- 稳定性：错误率≤0.1%；可用性≥99.5%。\n- 可访问性：对比度达标、键盘可用、字体可调、替代文本。
日签生成器是一款图文卡片生成工具，用户可以通过输入文字内容和图片，生成个性化的日签卡片。当前版本为 Web 应用，功能较为基础，用户需要手动输入内容和上传图片。为了提升用户体验和扩展应用场景，计划对项目进行以下改进：
1. 增加自动生成内容的功能，支持从内置数据库或在线资源中获取图片和文字。
2. 增加 Android 应用支持，方便用户在移动端使用。
3. 丰富主题和样式选择，提供多种个性化模板。

---

## 2. 项目目标
### 2.1 功能目标
- 支持用户手动输入文字和上传图片生成日签。
- 提供自动生成内容的功能，支持从内置数据库或在线资源中获取内容。
- 提供多种主题和样式选择，满足不同用户的个性化需求。
- 支持日签的高清图片导出和下载。
- 增加 Android 应用支持，提供更便捷的使用方式。

### 2.2 技术目标
- 构建高效、稳定的系统架构，支持多种功能扩展。
- 提供可扩展的数据库设计，支持多种主题和内容类型。
- 确保系统的跨平台兼容性，支持 Web 和 Android。

### 2.3 用户体验目标
- 提供简洁直观的界面，支持用户快速生成日签。
- 提供丰富的内容选择，提升用户满意度。
- 支持多种语言和主题，适配不同用户群体。

---

## 3. 功能需求
### 3.1 核心功能
#### 3.1.1 手动生成日签
- 用户可以手动输入文字内容。
- 用户可以上传图片（如插图、头像、二维码等）。
- 用户可以选择字体、颜色、布局模板等样式设置。
- 实时预览生成的日签效果。

#### 3.1.2 自动生成日签
- 用户可以选择主题（如电影、文学、音乐等）。
- 系统根据日期自动从内置数据库或在线资源中选择图片和文字。
- 提供“全自动生成”选项，用户无需手动输入内容。

#### 3.1.3 多主题支持
- **模板与主题规范**：
  - 网格：安全边距24px；内容区最大宽度随设备；标题/副文/日期/署名位置固定。
  - 字体：中文优先本地系统字体；商用字体需许可；加载失败回退。
  - 资源：图片CORS可控；统一托管与压缩；EXIF清理；署名与来源显示规则。
- 提供多种主题（如电影、文学、音乐、博物、人生感悟等）。
- 每个主题包含丰富的图片和文字内容。
- 用户可以切换主题，生成不同风格的日签。

#### 3.1.4 日签导出
- 支持将生成的日签导出为高清图片（PNG 格式）。
- 支持自定义文件名（如“日签-2026年1月1日.png”）。

#### 3.1.5 Android 应用支持
- **实现路径**：
  - 阶段一：WebView/TWA嵌入现有Web，快速上线；离线库打包内置；图片/字体打包或CDN。
  - 阶段二：React Native重构关键渲染与导出，提升性能与体验；保留同库与算法。
- 提供 Android 应用，支持用户在移动端生成和下载日签。
- 支持离线模式，用户可以在无网络的情况下使用内置数据库生成日签。

---

### 3.2 扩展功能
#### 3.2.1 在线搜索 API\n- 统一代理服务：服务端持有第三方密钥；前端无密钥；基于IP/用户会话限流。\n- 缓存：文本24h、图片CDN长期；失败回退到内置库；断网走离线库。\n- 隐私：不记录用户输入内容的明文；仅留请求元数据（最短30天）。
- 支持通过在线 API 获取内容（如电影台词、文学摘录等）。
- 提供代理服务器支持，解决国内用户的访问限制问题。
- 支持多种 API（如 TMDb、Unsplash、Google Books、网易云音乐等）。

#### 3.2.2 数据库管理\n- 自动/人工混合库流程：\n  - 采集：API/爬取（遵守robots与版权）、导入CSV/JSON。\n  - 规范化：字段标准化（主题、题材、语言、标签、来源URL、版权状态）。\n  - 清洗：去重、语言检测、长度校验、敏感词过滤、图片质量检测。\n  - 标注：主题/风格标签、关键词、来源署名、版权许可。\n  - 审核：人工抽检与打分；低分隔离；质控阈值≥0.8。\n  - 发布：生成只读库（版本号）；变更日志；可回滚。\n  - 更新：周更；紧急修复即刻；灰度发布。
- 提供内置数据库，存储预设的图片和文字内容。
- 数据库支持多主题和多语言内容。
- 提供数据更新功能，支持定期更新内容。

#### 3.2.3 内容选择算法\n- 输入：日期/主题/用户偏好；上下文：已使用历史、覆盖度、冷却期。\n- 打分：相关性R（主题匹配）、质量Q（人工/自动评分）、新鲜度F、覆盖C、重复惩罚D。\n- 选择：Top-K候选→多样性重排→保留随机性（温度系数），保证全年不重复且主题均衡。\n- 文本长度：主标题≤28字、副文≤60字；超长截断+省略；保留完整句优先。\n\n#### 3.2.3 多语言支持
- 支持中文、英文等多种语言。
- 根据用户的语言设置动态调整界面和内容。

#### 3.2.4 高级样式设置
- 提供更多样式选项（如边框、背景纹理、渐变效果等）。
- 支持用户自定义布局模板。

---

## 4. 技术实现

### 运维与监控
- **指标**：成功率、生成耗时、API失败率、离线命中率、崩溃率。
- **报警**：阈值触发（如API错误率>2%）。

### 异常与回退方案
- **特性开关**：自动生成/在线API独立开关。
- **降级**：API失败→本地库；图片失败→替代插画；文本失败→通用文案。
- **回滚**：库版本化；一键回退至上一版。
### 4.1 系统架构
- **前端**：
  - 使用 React 构建 Web 应用。
  - 使用 React Native 或 Flutter 构建 Android 应用。
- **后端**：
  - 使用 Node.js 或 Python（Flask/Django）构建后端服务。
  - 提供 RESTful API，支持前端和移动端的内容请求。
- **数据库**：
  - 使用 SQLite 或 JSON 文件存储本地数据（适合离线模式）。
  - 使用 MySQL 或 MongoDB 存储云端数据（适合在线模式）。

### 4.2 数据来源

#### 离线与缓存策略
- 前端缓存：IndexedDB/CacheStorage；文本上限10MB，图片按LRU。
- 预生成：每日预选1-3条候选；断网时直接使用。
- **内置数据库**：
  - 通过爬虫技术或手动整理获取数据。
  - 数据来源包括 IMDb、豆瓣、Unsplash、维基百科等。
- **在线 API**：
  - 调用第三方 API（如 TMDb、Google Books、Spotify 等）获取实时内容。

### 4.3 图片导出
- 使用 `html2canvas` 将日签的 DOM 元素渲染为 Canvas。
- 将 Canvas 转换为 PNG 格式的图片，并提供下载功能。

---

## 5. 用户界面设计
### 5.1 Web 应用
- **首页**：
  - 显示日签生成器的主要功能入口。
  - 提供手动生成和自动生成的选项。
- **编辑页面**：
  - 左侧为用户输入和设置区域。
  - 右侧为日签的实时预览区域。
- **下载按钮**：
  - 位于页面底部，支持一键导出日签。

### 5.2 Android 应用
- **首页**：
  - 提供手动生成和自动生成的选项。
- **编辑页面**：
  - 支持用户输入文字、上传图片和设置样式。
  - 提供实时预览功能。
- **离线模式**：
  - 用户可以在无网络的情况下使用内置数据库生成日签。

---

## 6. 数据库设计
### 6.1 表结构
- **`themes` 表**：
  - 存储主题信息。
  - 字段：`id`（主键）、`name`（主题名称）、`description`（主题描述）。
- **`content` 表**：
  - 存储具体内容（文字、图片等）。
  - 字段：`id`（主键）、`theme_id`（外键，关联 `themes` 表）、`text`（文字内容）、`image_url`（图片链接）、`source`（数据来源）。

### 6.2 数据来源
- **电影类**：
  - 数据来源：TMDb、豆瓣电影。
  - 内容：电影台词、剧照。
- **文学类**：
  - 数据来源：Google Books、Project Gutenberg。
  - 内容：经典文学作品摘录、相关图片。
- **音乐类**：
  - 数据来源：Spotify、网易云音乐。
  - 内容：歌词、专辑封面。
- **博物类**：
  - 数据来源：维基百科、Unsplash。
  - 内容：自然风景、动物图片、相关文字。
- **人生感悟类**：
  - 数据来源：Quotes API、手动整理。
  - 内容：心灵鸡汤、励志语录。

---

## 7. 项目计划
### 7.1 开发阶段
1. **需求分析**（1 周）：
   - 确定功能需求和技术方案。
2. **前端开发**（3 周）：
   - 实现 Web 应用的界面和功能。
3. **后端开发**（2 周）：
   - 搭建后端服务，提供 API 支持。
4. **数据库构建**（2 周）：
   - 收集和整理数据，构建内置数据库。
5. **Android 应用开发**（4 周）：
   - 使用 React Native 或 Flutter 开发移动端应用。
6. **测试与优化**（2 周）：
   - 进行功能测试和性能优化。

### 7.2 发布阶段

### 迭代计划
- **里程碑M1（1周）**：补全PRD缺失项与设计说明；确定Android阶段一方案；落定API与代理规范。
- **里程碑M2（2-3周）**：Web自动生成链路与模板规范落地；内置库v1发布；E2E打通导出与离线。
- **里程碑M3（2周）**：代理服务上线、缓存与限流、监控联通；法务审查与版权清单。
- **里程碑M4（2-3周）**：Android阶段一发布（WebView/TWA）；渠道分发与用户手册。
- **里程碑M5（3-4周）**：React Native优化（阶段二），性能专项与A/B。

### 文档体系
- PRD（本文件）。
- 架构设计说明（组件/流程/序列图）。
- 数据字典与采集清洗规范。
- API与代理规范。
- 测试策略与用例集。
- 运维与发布手册。
- 变更记录与经验教训。

### 测试与CI/CD策略
- **测试**：单测（算法/日期/渲染）、集成（导出/CORS）、E2E（主要流程）、数据管道测试（采集/清洗/发布）。
- **覆盖率**：语句80%/函数70%/分支60%。
- **CI**：拉取请求自动构建与测试；主干保护；自动生成变更日志。
- **发布**：Web自动化部署+回滚；APK签名、渠道包、版本分发。
- 发布 Web 应用和 Android 应用。
- 提供用户手册和技术文档。

---

## 8. 风险与解决方案

### 法务与合规
- 图片与文本来源的许可核验；强制署名；不允许未授权商用素材入库。
- 用户输入内容不做云端存储；仅本地生成；日志匿名化。
### 8.1 风险
- **API 调用限制**：在线 API 的免费额度可能不足。
- **国内访问限制**：部分国外 API 在国内可能无法访问。
- **数据质量问题**：自动获取的数据可能存在冗余或错误。

### 8.2 解决方案
- **API 调用限制**：结合内置数据库和在线 API，减少 API 调用次数。
- **国内访问限制**：通过代理服务器解决访问问题。
- **数据质量问题**：结合人工清洗和自动化工具，确保数据质量。

---

如果您有其他需求或需要进一步调整，请随时告诉我！

## 9. 需确认/选择
- Android阶段一采用WebView/TWA；阶段二采用React Native。
- 代理服务与缓存部署预算（云主机/带宽/域名/证书）。
- 版权策略：严格只收录可商用许可与明确署名素材。
- 数据主题优先级：先做电影/文学/人生感悟三类，其他迭代加入。
- 是否开启匿名使用统计与崩溃上报（默认开启，提供设置关闭）。
